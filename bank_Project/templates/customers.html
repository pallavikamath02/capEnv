{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card section-card">
            <div class="card-header bg-primary text-white">Customers</div>
            <div class="card-body">
                <h5>Add Customer</h5>
                <form id="customerForm">
                    <div class="row">
                        <div class="col-md-6 mb-2"><input type="text" class="form-control" id="custId" placeholder="Customer ID" required></div>
                        <div class="col-md-6 mb-2"><input type="text" class="form-control" id="custName" placeholder="Name" required></div>
                        <div class="col-md-6 mb-2"><input type="email" class="form-control" id="custEmail" placeholder="Email" required></div>
                        <div class="col-md-6 mb-2"><input type="text" class="form-control" id="custPhone" placeholder="Phone" required></div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Create Customer</button>
                </form>
                <hr>
                <h5>All Customers <button class="btn btn-sm btn-outline-secondary float-end" onclick="loadCustomers()">Refresh</button></h5>
                <div class="scrollable-table">
                    <ul class="list-group" id="customerList"></ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('customerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            customer_id: document.getElementById('custId').value,
            name: document.getElementById('custName').value,
            email: document.getElementById('custEmail').value,
            phone_number: document.getElementById('custPhone').value
        };
        try {
            const res = await fetch('/customers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            alert(result.message || result.error);
            if(res.ok) {
                document.getElementById('customerForm').reset();
                loadCustomers();
            }
        } catch(err) { alert('Error: ' + err); }
    });

    async function loadCustomers() {
        const list = document.getElementById('customerList');
        list.innerHTML = 'Loading...';
        try {
            const res = await fetch('/customers');
            const data = await res.json();
            list.innerHTML = '';
            if (data.length === 0) list.innerHTML = '<li class="list-group-item">No customers found.</li>';
            data.forEach(c => {
                list.innerHTML += `<li class="list-group-item">
                    <strong>${c.name}</strong> (ID: ${c.customer_id})<br>
                    <small>${c.email} | ${c.phone_number}</small>
                </li>`;
            });
        } catch(err) { list.innerHTML = 'Error loading data'; }
    }

    // Initial Load
    loadCustomers();
</script>
{% endblock %}